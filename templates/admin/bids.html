{% extends "base.html" %}

{% block title %}Bids for {{ auction.title }} - Admin{% endblock %}

{% block precontent %}{% endblock %}

{% block content %}
<div class="admin-layout">
    <aside class="admin-sidebar">
        <div class="logo">
            <span class="logo-icon"><img src="{{ url_for('static', filename='img/zolta-icon.png') }}" alt="Zolta" loading="lazy"></span>
            Zolta Admin
        </div>
        <ul class="admin-nav">
            <li><a href="{{ url_for('admin_dashboard') }}">Dashboard</a></li>
            <li><a href="{{ url_for('admin_new_auction') }}">New Auction</a></li>
            <li><a href="{{ url_for('admin_settings') }}">Settings</a></li>
            {% if session.get('admin_role','admin') == 'admin' %}
            <li><a href="{{ url_for('admin_users') }}">Users</a></li>
            {% endif %}
            <li><a href="{{ url_for('index') }}">View Site</a></li>
            <li><a href="{{ url_for('admin_logout') }}">Logout</a></li>
        </ul>
    </aside>
    
    <main class="admin-main">
        {% include "_flashes.html" %}
        <div class="admin-header">
            <div>
                <h1>Bids for: {{ auction.title }}</h1>
                <p style="color: var(--text-secondary); margin-top: 0.5rem;">
                    Status: <span class="auction-status {{ auction.status }}">{{ auction.status }}</span>
                    | Current Price: <strong>‚Ç¨{{ "%.2f"|format(auction.current_price) }}</strong>
                    | Total Bids: <strong>{{ bids|length }}</strong>
                </p>
            </div>
            <a href="{{ url_for('admin_dashboard') }}" class="btn btn-secondary">‚Üê Back</a>
        </div>
        
        {% if bids %}
        <div class="table-container">
            <table class="table">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Bidder Name</th>
                        <th>Email</th>
                        <th>Amount</th>
                        <th>Date & Time</th>
                    </tr>
                </thead>
                <tbody>
                    {% for bid in bids %}
                    <tr {% if loop.first %}style="background: #f0fdf4;"{% endif %}>
                        <td>
                            {% if loop.first %}
                            <span style="background: var(--success-color); color: white; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.75rem;">WINNER</span>
                            {% else %}
                            {{ loop.index }}
                            {% endif %}
                        </td>
                        <td><strong>{{ bid.bidder_name }}</strong></td>
                        <td>
                            <a href="mailto:{{ bid.bidder_email }}">{{ bid.bidder_email }}</a>
                        </td>
                        <td><strong>‚Ç¨{{ "%.2f"|format(bid.amount) }}</strong></td>
                        <td>{{ bid.created_at.strftime('%b %d, %Y at %H:%M:%S') }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        
        {% if auction.status == 'ended' and bids %}
        <div class="admin-form mt-2" style="background: #f0fdf4; border: 2px solid var(--success-color);">
            <h3 style="color: #166534;">üéâ Winner Information</h3>
            <p><strong>Name:</strong> {{ bids[0].bidder_name }}</p>
            <p><strong>Email:</strong> <a href="mailto:{{ bids[0].bidder_email }}">{{ bids[0].bidder_email }}</a></p>
            <p><strong>Winning Bid:</strong> ‚Ç¨{{ "%.2f"|format(bids[0].amount) }}</p>
            <p><strong>Bid Placed:</strong> {{ bids[0].created_at.strftime('%B %d, %Y at %H:%M') }}</p>
            
            <a href="mailto:{{ bids[0].bidder_email }}?subject=Congratulations! You won the auction for {{ auction.title }}&body=Hi {{ bids[0].bidder_name }},%0A%0ACongratulations! You have won the auction for {{ auction.title }} with your bid of ‚Ç¨{{ '%.2f'|format(bids[0].amount) }}.%0A%0APlease reply to this email to arrange pickup/payment.%0A%0AThank you!" 
               class="btn btn-success mt-1">
                üìß Email Winner
            </a>
        </div>
        {% endif %}
        
        {% else %}
        <div class="empty-state">
            <div class="empty-state-icon">üìã</div>
            <h2>No Bids Yet</h2>
            <p>This auction hasn't received any bids.</p>
        </div>
        {% endif %}
    </main>
</div>
{% endblock %}
