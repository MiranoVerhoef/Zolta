{% extends "base.html" %}

{% block title %}Biedingen - Admin{% endblock %}

{% block precontent %}{% endblock %}

{% block content %}
<div class="admin-shell">
  <div class="admin-layout">
    <aside class="admin-sidebar">
        <div class="logo">
            <span class="logo-icon"><img src="{{ url_for('static', filename='img/zolta-icon.png') }}" alt="Zolta" loading="lazy"></span>
            Zolta Admin
        </div>
        <ul class="admin-nav">
            <li><a href="{{ url_for('admin_dashboard') }}">Dashboard</a></li>
            <li><a href="{{ url_for('admin_new_auction') }}">Nieuwe veiling</a></li>
            <li><a href="{{ url_for('admin_settings') }}">Instellingen</a></li>
            {% if session.get('admin_role','admin') == 'admin' %}
            <li><a href="{{ url_for('admin_users') }}">Gebruikers</a></li>
            {% endif %}
            <li><a href="{{ url_for('index') }}">Website bekijken</a></li>
            <li><a href="{{ url_for('admin_logout') }}">Uitloggen</a></li>
        </ul>
    </aside>

    <main class="admin-main">
        {% include "_flashes.html" %}
        <div class="admin-header">
            <div>
                <h1>Biedingen voor: {{ auction.title }}</h1>
                <p style="color: var(--text-secondary); margin-top: 0.5rem;">
                    Status:
                    <span class="auction-status {{ auction.status }}">
                        {% if auction.status == 'active' %}Actief
                        {% elif auction.status == 'upcoming' %}Aankomend
                        {% elif auction.status == 'inactive' %}Inactief
                        {% else %}Afgelopen
                        {% endif %}
                    </span>
                    | Huidig bod: <strong>€{{ "%.2f"|format(auction.current_price) }}</strong>
                    | Totaal biedingen: <strong>{{ bids|length }}</strong>
                </p>
            </div>
            <a href="{{ url_for('admin_dashboard') }}" class="btn btn-secondary">← Terug</a>
        </div>

        {% if bids %}
        <div class="table-container">
            <table class="table">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Naam</th>
                        <th>E-mail</th>
                        <th>Bedrag</th>
                        <th>Datum & tijd</th>
                    </tr>
                </thead>
                <tbody>
                    {% for bid in bids %}
                    <tr {% if loop.first %}style="background: #f0fdf4;"{% endif %}>
                        <td>
                            {% if loop.first %}
                            <span style="background: var(--success-color); color: white; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.75rem;">WINNAAR</span>
                            {% else %}
                            {{ loop.index }}
                            {% endif %}
                        </td>
                        <td><strong>{{ bid.bidder_name }}</strong></td>
                        <td>
                            <a href="mailto:{{ bid.bidder_email }}">{{ bid.bidder_email }}</a>
                        </td>
                        <td><strong>€{{ "%.2f"|format(bid.amount) }}</strong></td>
                        <td>{{ bid.created_at.strftime('%d-%m-%Y %H:%M:%S') }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        {% if auction.status == 'ended' and bids %}
        <div class="admin-form mt-2" style="background: #f0fdf4; border: 2px solid var(--success-color);">
            <h3 style="color: #166534;">Winnaar informatie</h3>
            <p><strong>Naam:</strong> {{ bids[0].bidder_name }}</p>
            <p><strong>E-mail:</strong> <a href="mailto:{{ bids[0].bidder_email }}">{{ bids[0].bidder_email }}</a></p>
            <p><strong>Winnend bod:</strong> €{{ "%.2f"|format(bids[0].amount) }}</p>
            <p><strong>Bod geplaatst:</strong> {{ bids[0].created_at.strftime('%d-%m-%Y %H:%M') }}</p>

            <a href="mailto:{{ bids[0].bidder_email }}?subject=Gefeliciteerd! Je hebt gewonnen: {{ auction.title }}&body=Hallo {{ bids[0].bidder_name }},%0A%0AGefeliciteerd! Je hebt de veiling {{ auction.title }} gewonnen met een bod van €{{ '%.2f'|format(bids[0].amount) }}.%0A%0ANeem alsjeblieft contact op om afhalen/betalen af te stemmen.%0A%0ABedankt!"
               class="btn btn-success mt-1">
                E-mail winnaar
            </a>
        </div>
        {% endif %}

        {% else %}
        <div class="empty-state">
            <div class="empty-state-icon"></div>
            <h2>Nog geen biedingen</h2>
            <p>Deze veiling heeft nog geen biedingen ontvangen.</p>
        </div>
        {% endif %}
    </main>
</div>
{% endblock %}
